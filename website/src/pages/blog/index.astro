---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => {
	return data.draft !== true;
});

const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Layout title="Blog | Kitledger">
	<main>
		<h1>Latest News</h1>
		<p>Updates, release notes, and engineering deep dives.</p>

		<ul>
			{sortedPosts.map((post) => (
				<li>
					<article>
						<header>
							<time datetime={post.data.date.toISOString()}>
								{post.data.date.toLocaleDateString('en-US', {
									year: 'numeric',
									month: 'long',
									day: 'numeric'
								})}
							</time>
							<h2>
								<a href={`/blog/${post.slug}`}>
									{post.data.title}
								</a>
							</h2>
						</header>
						<p>{post.data.description}</p>
						<small>By {post.data.author}</small>
					</article>
				</li>
			))}
		</ul>
	</main>
</Layout>